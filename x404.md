# Sol X404
## Eth-X404
### [ERC404 Design Point](https://github.com/Pandora-Labs-Org/erc404)
1. Fully support ERC20/ERC721
2. One unit token bind to one NFT, NFT is circulated and mintable
3. ERC404 allows to transfer a specific NFT or a digital amount
4. NFT assigned according to balance is maintained through queue and transferred with priority.

### [XRGB-X404 Design Point](https://docs.xrgb.xyz/xrgb/x404-protocol)
1. Deposit
Anyone can add whitelist NFT assets, provide liquidity for NFTs, and receive a portion of the transaction fees subsequently.
2. different X404 Account (Seems not important if we all use mpl)
Each different type of NFT is an X404 contract, which is an extended ERC404 contract.
3. RedeemDeadLine (Lock of NFT supply)
After depositing NFTs, users will receive X404 tokens and can redeem their assets with priority within a specified period. After the redemption period expires, others can exchange for the assets by collecting a certain number of ERC404 tokens, which requires an extra transaction fee.

## Solana Concept

### SPL token
Standard for Fungible and Non-Fungible tokens. Can mint NFT or Fungible Token under same standard

### Transfer Hook

Token extension that allow specify a function to be triggered whenever a transfer is triggered.

## Proposal
### Instructions
1. Initiate
Input: Owner Pubkey, Redeem fee, max Redeem DDL
Functionality: Store Owner Pubkey, initiate global state, create fugible token mint account and NFT mint account.
2. Deposit
Input: NFT pubkeys, Redeem DDL, 
Functionality: Transfer NFT to program, store DDL and original owner with NFT, mint x404 tokens and transfer to user.

3. Redeem
Input: NFT pubkeys
Functionality: Check user has enough x404 for redeem fee and NFTs, Check Target NFT are all exceed DDL or it is the original owner. Pay the redeem fee with partial to original owner and burn x404 tokens for withdrawal the NFT.

4. Transfer Token Hook
Input: _from, _to, amount
Compute the balance of _from and _to and how many NFT they should have (exempt 0x0)
Mint or withdrawal NFT from _from and _to

4. Transfer NFT Hook
Input: _from, _to, NFT pubkey
Compute the balance of _from and _to and how many NFT they should have (exempt 0x0)
Mint or withdrawal NFT from _from and _to


## Trickky points:
1. Transfer Hook 
参考（https://solana.com/developers/guides/token-extensions/transfer-hook#Transfer Hook with wSOl Transfer fee (advanced example)）可以写两个delegate hook, 一个是转fungible token 的时候触发 NFT 转账逻辑，另一个是任意NFT转账的时候触发fungible token转账逻辑。NFT转账应该需要一个检查持有NFT的逻辑。
2. ERC404 不允许burn tokens
SPL token 没有办法禁用burn。所以在transfer hook 里需要优先检查balance状况是否匹配，如果不匹配需要提前withdral NFT 或者burn fungible token 来使得转账前双方状态都正常。 这个会导致在下一次转账前账户状态不同步，目前没想到别的办法处理。

